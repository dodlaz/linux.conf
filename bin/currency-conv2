#!/bin/bash


declare -A cur
cur["gbp"]="GBP"
cur["pund"]="GBP"
cur["£"]="GBP"
cur["sek"]="SEK"
cur["kr"]="SEK"
cur["usd"]="USD"
cur["dollar"]="USD"
cur["$"]="USD"
cur["eur"]="EUR"
cur["euro"]="EUR"
cur["€"]="EUR"
cur["btc"]="BTC"
cur["bitcoin"]="BTC"
cur["฿"]="BTC"

ColorOff='\033[0m'
Color='\033[1;31m'

currency() {
    if ! [[ $1 = *[[:digit:]]* && $2 != "" && $3 != "" ]]; then
        echo "Error" >2
        exit 3
    fi

    for e in $2; do
        c="${cur[${e,,}]}"
        for n in $3; do
            b="${cur[${n,,}]}"
            res="$(wget -qO- "http://www.google.com/finance/converter?a=$1&from=$c&to=$b" |  sed '/res/!d;s/<[^>]*>//g')";
 
            if [[ $res != "" ]]; then
                echo -ne "$Color$(echo -n $res | cut -d' ' -f1) $ColorOff"
                echo -ne "$(echo $res | cut -d' ' -f2-3)"
                echo -ne "$Color $(echo -n $res | cut -d' ' -f4) $ColorOff"
                echo -ne $res | cut -d' ' -f5-
            else
                echo -e "$Color$1$ColorOff $b = $Color$1$ColorOff $c"
            fi
        done
    done
}

HELP() {
    echo -e "Help:\ncurrency-conv [OPTION]... [VALUE] [[FROM] [TO]]"
    exit 0;
}
LIST() {
    echo -e "Swedish Krona: \t SEK (kr)
USE Dollar: \t USD ($)
British Pound: \t GBP (£)
European Euro: \t EUR (€)
Bitcoin: \t BTC (฿)";
    exit 0;
}


while getopts ':v:f:t:hl' flag; do
  case "${flag}" in
    h) HELP;;
    l) LIST;;
    
    v) value=${OPTARG} ;;
    f) from=${OPTARG}  ;;
    t) to=${OPTARG}    ;;
    
    *)
        (>&2 echo -e "Unexpected option ${flag}");
        exit 1;
        ;;
  esac
done
shift $((OPTIND-1))

args=( "$@" )
n=0
if [ -z "$value" ]; then
   value="${args[$n]}"
   ((n++))
fi
if [ -z "$from" ]; then
   from="${args[$n]}"
   ((n++))
fi
if [ -z "$to" ]; then
   to="${args[$n]}"
   ((n++))
fi

# Check if amount is a nubber
if ! [[ $value = *[[:digit:]]* ]] ; then
   echo "error: Not a number" >&2
   exit 2
else
    value="$(echo $value | bc -l)"
fi



if [[ $value != "" && $from != "" && $to != "" ]]; then
    currency $value "$from" "$to"
elif [[ $value != "" && $from != "" ]]; then
    currency $value "SEK USD EUR GBP BTC" "$from"
elif [[ $value != "" ]]; then
    currency $value "SEK USD EUR GBP BTC" "SEK"            
elif [[ $value == "" ]]; then
    currency 1 "SEK USD EUR GBP BTC" "SEK"
fi






